<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-5661724500759448">
    <title>チケットメーカー</title>
    <style>
        @font-face { font-family: 'ITC Avant Garde Gothic Std Extra Light'; src: url('fonts/ITC Avant Garde Gothic Std Extra Light.woff2?v=1.0') format('woff2'); }
        @font-face { font-family: 'AR ADGothicJP'; src: url('fonts/jadhei01m.woff2?v=1.0') format('woff2'); }
        @font-face { font-family: 'KozGoPr6N'; src: url('fonts/KozGoPr6N-Medium.woff2?v=1.0') format('woff2'); }
        body { font-family: "KozGoPr6N", "AR ADGothicJP", "YuGothic", "Meiryo", sans-serif; margin: 0; padding: 20px; background: #FFF4F6; color: #F676A6; position: relative; }
        #mainContainer { display: flex; justify-content: space-between; }
        #canvasContainer { width: 50%; text-align: center; overflow: auto; }
        #ticketCanvas { border: 1px solid #ccc; }
        #controlsContainer { width: 45%; overflow-y: auto; max-height: 90vh; }
        .input-group { margin: 10px 0; }
        .note { color: #F676A6; font-size: 14px; }
        .position-input, .spacing-input, .size-input, .line-height-input, .shadow-input, .opacity-input { width: 50px; margin-left: 5px; display: none; }
        .advanced-mode.active .position-input, .advanced-mode.active .spacing-input, .advanced-mode.active .size-input, .advanced-mode.active .line-height-input, .advanced-mode.active .shadow-input, .advanced-mode.active .opacity-input { display: inline; }
        .advanced-label { display: none; }
        .advanced-mode.active .advanced-label { display: inline; }
        #previewSizeButtons { margin-top: 10px; }
        #previewSizeButtons button, .input-group button { margin: 0 5px 10px; padding: 8px 16px; border-radius: 20px; border: none; background: #F676A6; color: #FFF; cursor: pointer; }
        #previewSizeButtons button:hover, .input-group button:hover { background: #E55A8C; }
        .error-msg { color: red; font-size: 12px; margin-left: 5px; display: none; }
        .ad-container { text-align: center; margin: 20px 0; }
        #languageSelector { position: absolute; top: 10px; right: 10px; color: #F676A6; }
        #disclaimer { font-size: 7pt; color: #F676A6; text-align: center; margin-top: 10px; }
        #loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.7); color: #FFF; padding: 20px; border-radius: 10px; display: none; }
        @media (max-width: 768px) {
            #mainContainer { flex-direction: column; }
            #canvasContainer, #controlsContainer { width: 100%; }
            #canvasContainer { order: 2; }
            #controlsContainer { order: 1; }
        }
        @media (max-width: 1024px) and (orientation: landscape) {
            #canvasContainer { width: 60%; }
            #controlsContainer { width: 35%; }
        }
    </style>
    <link rel="preload" href="fonts/ITC Avant Garde Gothic Std Extra Light.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="fonts/jadhei01m.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="fonts/KozGoPr6N-Medium.woff2" as="font" type="font/woff2" crossorigin>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5661724500759448" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="ad-container">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5661724500759448" data-ad-slot="5661724500759448" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    <select id="languageSelector" onchange="changeLanguage(this.value)">
        <option value="ja" selected>日本語</option>
        <option value="zh-TW">中文（繁體）</option>
        <option value="zh-CN">中文（简体）</option>
        <option value="en">English</option>
        <option value="ko">한국어</option>
        <option value="th">ไทย</option>
        <option value="id">Bahasa Indonesia</option>
    </select>
    <div id="mainContainer">
        <div id="canvasContainer">
            <h1>チケットプレビュー</h1>
            <canvas id="ticketCanvas" aria-label="Ticket preview canvas"></canvas>
            <div id="previewSizeButtons">
                <button onclick="setPreviewScale(0.12)">12%</button>
                <button onclick="setPreviewScale(0.25)">25%</button>
                <button onclick="setPreviewScale(0.5)">50%</button>
                <button onclick="setPreviewScale(1.0)">100%</button>
            </div>
            <p id="disclaimer" data-key="disclaimer">AKB48メンバーの生誕祭劇場公演で、ファンの皆様が復刻した劇場チケットに感動し、趣味としてファンが自作チケットを保存できるウェブサイトを制作いたしました。商業目的や違法な使用はご遠慮ください。権利は© AKB48及び株式会社DHに帰属し、制作者は責任を負いかねます。何卒ご了承ください。</p>
        </div>
        <div id="controlsContainer">
            <h1>オリジナルチケット</h1>
            <div class="input-group advanced-mode">
                <label data-key="rect1Line1" for="rect1Line1">エリア1 テキスト (1行目): <input type="text" id="rect1Line1" value="AKB" aria-label="エリア1 テキスト 1行目"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="rect1Line1X" value="13.5" class="position-input" aria-label="エリア1 テキスト 1行目 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="rect1Line1X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="rect1Line1Y" value="12" class="position-input" aria-label="エリア1 テキスト 1行目 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="rect1Line1Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="rect1Spacing" value="-7000" class="spacing-input" aria-label="エリア1 字間"><span class="error-msg" id="rect1Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="rect1Size" value="47" class="size-input" aria-label="エリア1 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="rect1Size-error"></span><br>
                <label data-key="rect1Line2" for="rect1Line2">エリア1 テキスト (2行目): <input type="text" id="rect1Line2" value="48" aria-label="エリア1 テキスト 2行目"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="rect1Line2X" value="13.5" class="position-input" aria-label="エリア1 テキスト 2行目 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="rect1Line2X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="rect1Line2Y" value="24" class="position-input" aria-label="エリア1 テキスト 2行目 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="rect1Line2Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="rect1Line2Spacing" value="-7000" class="spacing-input" aria-label="エリア1 2行目 字間"><span class="error-msg" id="rect1Line2Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="rect1Line2Size" value="47" class="size-input" aria-label="エリア1 2行目 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="rect1Line2Size-error"></span><br>
                <label data-key="rect1Color" for="rect1Color">エリア1 背景色: <input type="color" id="rect1Color" value="#2086D1" aria-label="エリア1 背景色"></label>
                <label data-key="rect1TextColor" for="rect1TextColor">エリア1 文字色: <input type="color" id="rect1TextColor" value="#FFFFFF" aria-label="エリア1 文字色"></label><br>
            </div>
            <div class="input-group advanced-mode">
                <label data-key="text2" for="text2">テキスト2: <input type="text" id="text2" value="「ここからだ」 公演" aria-label="テキスト2"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text2X" value="37" class="position-input" aria-label="テキスト2 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text2X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text2Y" value="12" class="position-input" aria-label="テキスト2 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text2Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text2Spacing" value="2000" class="spacing-input" aria-label="テキスト2 字間"><span class="error-msg" id="text2Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text2Size" value="14.2" class="size-input" aria-label="テキスト2 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text2Size-error"></span><br>
                <label data-key="text3Line1" for="text3Line1">テキスト3 (1行目): <input type="text" id="text3Line1" value="秋元康 生誕祭" aria-label="テキスト3 1行目"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text3Line1X" value="35" class="position-input" aria-label="テキスト3 1行目 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text3Line1X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text3Line1Y" value="19" class="position-input" aria-label="テキスト3 1行目 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text3Line1Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text3Spacing" value="2000" class="spacing-input" aria-label="テキスト3 字間"><span class="error-msg" id="text3Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text3Size" value="14.2" class="size-input" aria-label="テキスト3 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text3Size-error"></span>
                <label class="advanced-label" data-key="lineHeight">行間: </label><input type="number" id="text3LineHeight" value="18" class="line-height-input" aria-label="テキスト3 行間"><span class="advanced-label">pt</span><span class="error-msg" id="text3LineHeight-error"></span><br>
                <label data-key="text3Line2" for="text3Line2">テキスト3 (2行目): <input type="text" id="text3Line2" value="AKB48劇場" aria-label="テキスト3 2行目"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text3Line2X" value="35" class="position-input" aria-label="テキスト3 2行目 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text3Line2X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text3Line2Y" value="25" class="position-input" aria-label="テキスト3 2行目 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text3Line2Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text3Line2Spacing" value="2000" class="spacing-input" aria-label="テキスト3 2行目 字間"><span class="error-msg" id="text3Line2Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text3Line2Size" value="14.2" class="size-input" aria-label="テキスト3 2行目 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text3Line2Size-error"></span><br>
                <label data-key="text4Line1" for="text4Line1">テキスト4 (1行目): <input type="text" id="text4Line1" value="＜日付＞2025年05月02日（金）" aria-label="テキスト4 1行目"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text4Line1X" value="13" class="position-input" aria-label="テキスト4 1行目 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text4Line1X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text4Line1Y" value="43" class="position-input" aria-label="テキスト4 1行目 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text4Line1Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text4Spacing" value="1000" class="spacing-input" aria-label="テキスト4 字間"><span class="error-msg" id="text4Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text4Size" value="11" class="size-input" aria-label="テキスト4 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text4Size-error"></span>
                <label class="advanced-label" data-key="lineHeight">行間: </label><input type="number" id="text4LineHeight" value="14" class="line-height-input" aria-label="テキスト4 行間"><span class="advanced-label">pt</span><span class="error-msg" id="text4LineHeight-error"></span><br>
                <label data-key="text4Line2" for="text4Line2">テキスト4 (2行目): <input type="text" id="text4Line2" value="OPEN：18時10分       START：18時30分      ￥3,400" aria-label="テキスト4 2行目"></label><br>
                <label data-key="text5" for="text5">テキスト5: <input type="text" id="text5" value="048番" aria-label="テキスト5"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text5X" value="13" class="position-input" aria-label="テキスト5 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text5X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text5Y" value="55" class="position-input" aria-label="テキスト5 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text5Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text5Spacing" value="200" class="spacing-input" aria-label="テキスト5 字間"><span class="error-msg" id="text5Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text5Size" value="16" class="size-input" aria-label="テキスト5 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text5Size-error"></span><br>
                <label data-key="text6" for="text6">テキスト6: <input type="text" id="text6" value="① ❘ 000－0000 ❘ ゴメン先生 様" aria-label="テキスト6"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text6X" value="36" class="position-input" aria-label="テキスト6 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text6X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text6Y" value="55" class="position-input" aria-label="テキスト6 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text6Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text6Spacing" value="311" class="spacing-input" aria-label="テキスト6 字間"><span class="error-msg" id="text6Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text6Size" value="13" class="size-input" aria-label="テキスト6 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text6Size-error"></span><br>
                <label data-key="textColor" for="textColor">文字色 (2-6): <input type="color" id="textColor" value="#000000" aria-label="文字色 (2-6)"></label><br>
            </div>
            <div class="input-group advanced-mode">
                <label data-key="bgColor" for="bgColor">全体の背景色: <input type="color" id="bgColor" value="#E5EDF9" aria-label="全体の背景色"></label><br>
                <label data-key="bgText" for="bgText">背景テキスト: <input type="text" id="bgText" value="AKB48" aria-label="背景テキスト"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="bgTextX" value="-100" class="position-input" aria-label="背景テキスト X位置"><span class="advanced-label">mm</span><span class="error-msg" id="bgTextX-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="bgTextY" value="0" class="position-input" aria-label="背景テキスト Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="bgTextY-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="bgTextSpacing" value="-6000" class="spacing-input" aria-label="背景テキスト 字間"><span class="error-msg" id="bgTextSpacing-error"></span>
                <label class="advanced-label" data-key="lineHeight">行間: </label><input type="number" id="bgTextLineHeight" value="46" class="line-height-input" aria-label="背景テキスト 行間"><span class="advanced-label">pt</span><span class="error-msg" id="bgTextLineHeight-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="bgTextSize" value="62" class="size-input" aria-label="背景テキスト 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="bgTextSize-error"></span><br>
                <label data-key="bgTextColor" for="bgTextColor">背景文字色: <input type="color" id="bgTextColor" value="#FFFFFF" aria-label="背景文字色"></label>
                <label data-key="bgShadowColor" for="bgShadowColor">背景影の色: <input type="color" id="bgShadowColor" value="#5F96ED" aria-label="背景影の色"></label>
                <label class="advanced-label" data-key="shadowX">シャドウX: </label><input type="number" id="bgShadowX" value="0.5" step="0.1" class="shadow-input" aria-label="背景影 X偏移"><span class="advanced-label">mm</span><span class="error-msg" id="bgShadowX-error"></span>
                <label class="advanced-label" data-key="shadowY">シャドウY: </label><input type="number" id="bgShadowY" value="-0.4" step="0.1" class="shadow-input" aria-label="背景影 Y偏移"><span class="advanced-label">mm</span><span class="error-msg" id="bgShadowY-error"></span>
                <label class="advanced-label" data-key="shadowOpacity">シャドウ透明度: </label><input type="number" id="bgShadowOpacity" value="0.2" min="0" max="1" step="0.1" class="opacity-input" aria-label="背景影 透明度"><span class="advanced-label">（0-1）</span><span class="error-msg" id="bgShadowOpacity-error"></span><br>
            </div>
            <div class="input-group advanced-mode">
                <label data-key="rect9Color" for="rect9Color">エリア9 背景色: <input type="color" id="rect9Color" value="#2086D1" aria-label="エリア9 背景色"></label><br>
                <label data-key="text10" for="text10">テキスト10: <input type="text" id="text10" value="<主催 ‧ お問い合せ>" aria-label="テキスト10"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text10X" value="54" class="position-input" aria-label="テキスト10 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text10X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text10Y" value="62.5" class="position-input" aria-label="テキスト10 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text10Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text10Spacing" value="236" class="spacing-input" aria-label="テキスト10 字間"><span class="error-msg" id="text10Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text10Size" value="7" class="size-input" aria-label="テキスト10 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text10Size-error"></span><br>
                <label data-key="text11" for="text11">テキスト11: <input type="text" id="text11" value="AKB48 Theater" aria-label="テキスト11"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text11X" value="80.5" class="position-input" aria-label="テキスト11 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text11X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text11Y" value="63" class="position-input" aria-label="テキスト11 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text11Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text11Spacing" value="238" class="spacing-input" aria-label="テキスト11 字間"><span class="error-msg" id="text11Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text11Size" value="10" class="size-input" aria-label="テキスト11 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text11Size-error"></span><br>
                <label data-key="text12" for="text12">テキスト12: <input type="text" id="text12" value="TEL:03-5298-8648" aria-label="テキスト12"></label>
                <label class="advanced-label" data-key="x">X: </label><input type="number" id="text12X" value="108" class="position-input" aria-label="テキスト12 X位置"><span class="advanced-label">mm</span><span class="error-msg" id="text12X-error"></span>
                <label class="advanced-label" data-key="y">Y: </label><input type="number" id="text12Y" value="63" class="position-input" aria-label="テキスト12 Y位置"><span class="advanced-label">mm</span><span class="error-msg" id="text12Y-error"></span>
                <label class="advanced-label" data-key="spacing">字間: </label><input type="number" id="text12Spacing" value="236" class="spacing-input" aria-label="テキスト12 字間"><span class="error-msg" id="text12Spacing-error"></span>
                <label class="advanced-label" data-key="size">サイズ: </label><input type="number" id="text12Size" value="12.5" class="size-input" aria-label="テキスト12 文字サイズ"><span class="advanced-label">pt</span><span class="error-msg" id="text12Size-error"></span><br>
                <label data-key="footerTextColor" for="footerTextColor">文字色 (10-12): <input type="color" id="footerTextColor" value="#FFFFFF" aria-label="文字色 (10-12)"></label><br>
            </div>
            <div class="input-group">
                <label data-key="qrCodeInput" for="qrCodeInput">QRコード画像 (優先): <input type="file" id="qrCodeInput" accept="image/*" aria-label="QRコード画像"></label><br>
                <label data-key="qrCodeText" for="qrCodeText">QRコードテキスト: <input type="text" id="qrCodeText" placeholder="URLまたはテキスト" aria-label="QRコードテキスト"></label>
                <button onclick="generateQRCode()" data-key="generateQR" aria-label="QRコード生成">QRコード生成</button><br>
                <label data-key="showQR" for="showQR"><input type="checkbox" id="showQR" checked aria-label="QRコード枠を表示" onchange="debouncedDraw()"> QRコード枠を表示</label><br>
                <label data-key="qrSquareColor" for="qrSquareColor">QR枠の色: <input type="color" id="qrSquareColor" value="#2086D1" aria-label="QR枠の色"></label><br>
            </div>
            <div class="input-group">
                <label data-key="customImageInput" for="customImageInput">カスタム画像: <input type="file" id="customImageInput" accept="image/*" aria-label="カスタム画像"></label><br>
                <label data-key="imageLayer" for="imageLayer">画像のレイヤー: 
                    <select id="imageLayer" aria-label="画像のレイヤー" onchange="debouncedDraw()">
                        <option value="background">背景</option>
                        <option value="foreground">前景</option>
                    </select>
                </label>
            </div>
            <div class="input-group">
                <label data-key="customFontInput" for="customFontInput">カスタムフォント: <input type="file" id="customFontInput" accept=".woff,.woff2,.ttf,.otf" aria-label="カスタムフォント"></label><br>
            </div>
            <div class="input-group">
                <label data-key="bleedOption" for="bleedOption"><input type="checkbox" id="bleedOption" aria-label="裁ち落とし付き" onchange="debouncedDraw()"> 裁ち落とし付き (+3mm)</label>
            </div>
            <div class="input-group">
                <button onclick="downloadTicket(300)" data-key="download300" aria-label="ダウンロード 300 DPI">ダウンロード (300 DPI)</button>
                <button onclick="downloadTicket(70)" data-key="download70" aria-label="ダウンロード 70 DPI">ダウンロード (70 DPI)</button>
                <button id="advancedModeBtn" onclick="toggleAdvancedMode()" data-key="advancedMode" aria-label="詳細設定">詳細設定</button>
                <button onclick="window.open('https://paypal.me/gomensensei?country.x=HK&locale.x=zh_HK','_blank')" data-key="donate" aria-label="寄付する">寄付する</button>
                <button onclick="window.open('https://x.com/sorrysir_gomen','_blank')" data-key="reportBug" aria-label="報錯">報錯</button>
            </div>
            <p class="note" data-key="note">※ダウンロードしたPNGはRGBです。印刷用にCMYKへ変換するにはPhotoshopかGIMPをご利用ください。</p>
        </div>
    </div>
    <div class="ad-container">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5661724500759448" data-ad-slot="5661724500759448" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    <div id="loading">生成中...</div>

<script>
    const $ = id => document.getElementById(id);
    const canvas = $('ticketCanvas');
    const ctx = canvas.getContext('2d');

    const fonts = {
        avant: 'ITC Avant Garde Gothic Std 속Light, sans-serif',
        kozgo: 'KozGoPr6N, YuGothic, sans-serif',
        ar: 'AR ADGothicJP, MS PGothic, sans-serif',
        custom: null
    };
    const sizes = { base: { w: 150, h: 65 }, bleed: 3 };
    const dpi = {
        300: { base: { w: sizes.base.w * 300 / 25.4, h: sizes.base.h * 300 / 25.4 }, bleed: { w: (sizes.base.w + 2 * sizes.bleed) * 300 / 25.4, h: (sizes.base.h + 2 * sizes.bleed) * 300 / 25.4 } },
        70: { base: { w: sizes.base.w * 70 / 25.4, h: sizes.base.h * 70 / 25.4 }, bleed: { w: (sizes.base.w + 2 * sizes.bleed) * 70 / 25.4, h: (sizes.base.h + 2 * sizes.bleed) * 70 / 25.4 } }
    };
    let qrImage = null, customImage = null, previewScale = 0.5;

    const langs = {
        ja: { title: 'チケットメーカー', preview: 'チケットプレビュー', custom: 'オリジナルチケット', rect1Line1: 'エリア1 テキスト (1行目)', rect1Line2: 'エリア1 テキスト (2行目)', rect1Color: 'エリア1 背景色', rect1TextColor: 'エリア1 文字色', text2: 'テキスト2', text3Line1: 'テキスト3 (1行目)', text3Line2: 'テキスト3 (2行目)', text4Line1: 'テキスト4 (1行目)', text4Line2: 'テキスト4 (2行目)', text5: 'テキスト5', text6: 'テキスト6', textColor: '文字色 (2-6)', bgColor: '全体の背景色', bgText: '背景テキスト', bgTextColor: '背景文字色', bgShadowColor: '背景影の色', rect9Color: 'エリア9 背景色', text10: 'テキスト10', text11: 'テキスト11', text12: 'テキスト12', footerTextColor: '文字色 (10-12)', qrCodeInput: 'QRコード画像 (優先)', qrCodeText: 'QRコードテキスト', generateQR: 'QRコード生成', showQR: 'QRコード枠を表示', qrSquareColor: 'QR枠の色', customImageInput: 'カスタム画像', imageLayer: '画像のレイヤー', customFontInput: 'カスタムフォント', bleedOption: '裁ち落とし付き (+3mm)', download300: 'ダウンロード (300 DPI)', download70: 'ダウンロード (70 DPI)', advancedMode: '詳細設定', donate: '寄付する', reportBug: '報錯', note: '※ダウンロードしたPNGはRGBです。印刷用にCMYKへ変換するにはPhotoshopかGIMPをご利用ください。', disclaimer: 'AKB48メンバーの生誕祭劇場公演で、ファンの皆様が復刻した劇場チケットに感動し、趣味としてファンが自作チケットを保存できるウェブサイトを制作いたしました。商業目的や違法な使用はご遠慮ください。権利は© AKB48及び株式会社DHに帰属し、制作者は責任を負いかねます。何卒ご了承ください。', downloadError: 'ダウンロードに失敗しました。もう一度お試しください。', inputError: '負の値または無効な値は使用できません。', opacityError: '透明度は0から1の間で入力してください。', qrFormatError: 'サポートされていないファイル形式です。画像を選択してください。', qrLoadError: 'QRコード画像の読み込みに失敗しました。', qrReadError: 'ファイルの読み込みに失敗しました。', fontLoadError: 'フォントの読み込みに失敗しました。デフォルトフォントを使用します。', x: 'X', y: 'Y', spacing: '字間', size: 'サイズ', lineHeight: '行間', shadowX: 'シャドウX', shadowY: 'シャドウY', shadowOpacity: 'シャドウ透明度' },
        'zh-TW': { title: '門票生成器', preview: '門票預覽', custom: '自訂門票', rect1Line1: '矩形1文字 (行1)', rect1Line2: '矩形1文字 (行2)', rect1Color: '矩形1顏色', rect1TextColor: '矩形1文字顏色', text2: '文字2', text3Line1: '文字3 (行1)', text3Line2: '文字3 (行2)', text4Line1: '文字4 (行1)', text4Line2: '文字4 (行2)', text5: '文字5', text6: '文字6', textColor: '文字顏色 (2-6)', bgColor: '背景顏色', bgText: '背景文字', bgTextColor: '背景文字顏色', bgShadowColor: '背景陰影顏色', rect9Color: '矩形9顏色', text10: '文字10', text11: '文字11', text12: '文字12', footerTextColor: '文字顏色 (10-12)', qrCodeInput: 'QR碼圖片 (優先)', qrCodeText: 'QR碼文字', generateQR: '生成QR碼', showQR: '顯示QR碼框架', qrSquareColor: 'QR框架顏色', customImageInput: '自訂圖片', imageLayer: '圖片層次', customFontInput: '自訂字體', bleedOption: '包含出血位 (每邊 +3mm)', download300: '下載門票 (300 DPI)', download70: '下載門票 (70 DPI)', advancedMode: '進階模式', donate: '捐贈', reportBug: '回報錯誤', note: '注意：下載的PNG為RGB模式。為印刷準備，請使用Photoshop或GIMP轉為CMYK。', disclaimer: '有鑑於AKB48成員的生誕祭劇場公演中，粉絲製作的應援品包括已不再印刷的實體劇場門票復刻版，因此突發奇想製作此網站，讓粉絲們能自製心目中的票券並自行保存。此網站純粹出於興趣製作，請勿用於商業或其他非法用途。所有權利歸© AKB48及株式会社DH所有，本人對一切責任免責，請注意。', downloadError: '下載失敗。請再試一次。', inputError: '不可使用負值或無效值。', opacityError: '透明度必須介於0到1之間。', qrFormatError: '不支援的檔案格式。請選擇圖片。', qrLoadError: 'QR碼圖片載入失敗。', qrReadError: '檔案讀取失敗。', fontLoadError: '字體載入失敗，將使用預設字體。', x: 'X', y: 'Y', spacing: '字距', size: '大小', lineHeight: '行距', shadowX: '陰影X', shadowY: '陰影Y', shadowOpacity: '陰影透明度' }
        };

        const drawText = (lines, x, y, font, size, spacing, height, color, align = 'left', altFont, dpiVal = 300) => {
            const ptPx = dpiVal / 72;
            ctx.fillStyle = color;
            ctx.textAlign = align;
            lines.forEach((l, i) => {
                let cx = x, ly = y + i * height * ptPx;
                l.split('').forEach(c => {
                    const isLatin = /[a-zA-Z0-9]/.test(c);
                    ctx.font = `${size * ptPx}px ${isLatin && altFont ? altFont : font}`;
                    ctx.fillText(c, cx, ly);
                    cx += ctx.measureText(c).width + (spacing / 1000 * ptPx);
                });
            });
        };

        const drawTicket = (dpiVal = 70) => {
            const bleed = $('bleedOption').checked ? sizes.bleed : 0;
            const w = dpi[dpiVal][bleed ? 'bleed' : 'base'].w;
            const h = dpi[dpiVal][bleed ? 'bleed' : 'base'].h;
            canvas.width = w * previewScale;
            canvas.height = h * previewScale;
            ctx.scale(previewScale, previewScale);
            const mmPx = dpiVal / 25.4;

            // 背景色
            ctx.fillStyle = $('bgColor').value;
            ctx.fillRect(0, 0, w, h);

            // 自訂背景圖片（在背景色之上）
            if (customImage && $('imageLayer').value === 'background') {
                ctx.drawImage(customImage, 0, 0, w, h);
            }

            // 背景文字與陰影
            const shadowAlpha = Math.max(0, Math.min(1, parseFloat($('bgShadowOpacity').value) || 0));
            ctx.shadowColor = `${$('bgShadowColor').value}${Math.round(shadowAlpha * 255).toString(16).padStart(2, '0')}`;
            ctx.shadowOffsetX = parseFloat($('bgShadowX').value) * mmPx;
            ctx.shadowOffsetY = parseFloat($('bgShadowY').value) * mmPx;
            ctx.shadowBlur = 5;
            drawText([$('bgText').value], parseFloat($('bgTextX').value) * mmPx, parseFloat($('bgTextY').value) * mmPx, fonts.custom || fonts.avant, parseFloat($('bgTextSize').value), parseFloat($('bgTextSpacing').value), parseFloat($('bgTextLineHeight').value), $('bgTextColor').value, 'left', null, dpiVal);
            ctx.shadowColor = 'transparent';

            // 矩形1
            ctx.fillStyle = $('rect1Color').value;
            ctx.fillRect(bleed * mmPx, bleed * mmPx, 23 * mmPx, h - 2 * bleed * mmPx);
            drawText([$('rect1Line1').value, $('rect1Line2').value], parseFloat($('rect1Line1X').value) * mmPx, parseFloat($('rect1Line1Y').value) * mmPx, fonts.custom || fonts.avant, parseFloat($('rect1Size').value), parseFloat($('rect1Spacing').value), 12, $('rect1TextColor').value, 'left', null, dpiVal);

            // 文字2-6
            drawText([$('text2').value], parseFloat($('text2X').value) * mmPx, parseFloat($('text2Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text2Size').value), parseFloat($('text2Spacing').value), 0, $('textColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text3Line1').value, $('text3Line2').value], parseFloat($('text3Line1X').value) * mmPx, parseFloat($('text3Line1Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text3Size').value), parseFloat($('text3Spacing').value), parseFloat($('text3LineHeight').value), $('textColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text4Line1').value, $('text4Line2').value], parseFloat($('text4Line1X').value) * mmPx, parseFloat($('text4Line1Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text4Size').value), parseFloat($('text4Spacing').value), parseFloat($('text4LineHeight').value), $('textColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text5').value], parseFloat($('text5X').value) * mmPx, parseFloat($('text5Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text5Size').value), parseFloat($('text5Spacing').value), 0, $('textColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text6').value], parseFloat($('text6X').value) * mmPx, parseFloat($('text6Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text6Size').value), parseFloat($('text6Spacing').value), 0, $('textColor').value, 'left', fonts.ar, dpiVal);

            // 矩形9
            ctx.fillStyle = $('rect9Color').value;
            ctx.fillRect(bleed * mmPx, (sizes.base.h - 7 + bleed) * mmPx, (sizes.base.w - 2 * bleed) * mmPx, 7 * mmPx);
            drawText([$('text10').value], parseFloat($('text10X').value) * mmPx, parseFloat($('text10Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text10Size').value), parseFloat($('text10Spacing').value), 0, $('footerTextColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text11').value], parseFloat($('text11X').value) * mmPx, parseFloat($('text11Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text11Size').value), parseFloat($('text11Spacing').value), 0, $('footerTextColor').value, 'left', fonts.ar, dpiVal);
            drawText([$('text12').value], parseFloat($('text12X').value) * mmPx, parseFloat($('text12Y').value) * mmPx, fonts.custom || fonts.kozgo, parseFloat($('text12Size').value), parseFloat($('text12Spacing').value), 0, $('footerTextColor').value, 'left', fonts.ar, dpiVal);

            // QR碼框架（先繪製框架，再繪製QR碼圖片）
            if ($('showQR').checked) {
                ctx.fillStyle = $('qrSquareColor').value;
                ctx.fillRect((sizes.base.w - 23 + bleed) * mmPx, bleed * mmPx, 23 * mmPx, 23 * mmPx);
            }
            if (qrImage) {
                ctx.drawImage(qrImage, (sizes.base.w - 23 + bleed) * mmPx, bleed * mmPx, 23 * mmPx, 23 * mmPx);
            }

            // 自訂前景圖片（在所有文字和QR碼之上）
            if (customImage && $('imageLayer').value === 'foreground') {
                ctx.drawImage(customImage, 0, 0, w, h);
            }
        };

        const debouncedDraw = debounce(() => drawTicket(70), 300);

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func(...args), wait);
            };
        }

        function validateInput(input, errorId, min = 0) {
            const val = parseFloat(input.value);
            const error = $(errorId);
            if (isNaN(val) || val < min) {
                error.textContent = langs[document.documentElement.lang]?.inputError || '負の値または無効な値は使用できません。';
                error.style.display = 'inline';
                input.value = min;
                debouncedDraw();
                return false;
            }
            if (input.classList.contains('opacity-input') && (val > 1 || val < 0)) {
                error.textContent = langs[document.documentElement.lang]?.opacityError || '透明度は0から1の間で入力してください。';
                error.style.display = 'inline';
                input.value = Math.max(0, Math.min(1, val));
                debouncedDraw();
                return false;
            }
            error.style.display = 'none';
            return true;
        }

        function generateQRCode() {
            const text = $('qrCodeText').value;
            if (!text) return;
            const qrCanvas = document.createElement('canvas');
            QRCode.toCanvas(qrCanvas, text, { width: 300, margin: 1 }, (error) => {
                if (error) {
                    console.error(error);
                    return;
                }
                qrImage = new Image();
                qrImage.src = qrCanvas.toDataURL();
                qrImage.onload = debouncedDraw;
            });
        }

        function downloadTicket(dpiVal) {
            $('loading').style.display = 'block';
            setTimeout(() => {
                drawTicket(dpiVal);
                const bleed = $('bleedOption').checked ? '_bleed' : '';
                const link = document.createElement('a');
                link.download = `ticket_${dpiVal}dpi${bleed}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                $('loading').style.display = 'none';
            }, 100);
        }

        function setPreviewScale(scale) {
            previewScale = scale;
            debouncedDraw();
        }

        function toggleAdvancedMode() {
            document.querySelectorAll('.advanced-mode').forEach(el => el.classList.toggle('active'));
            $('advancedModeBtn').textContent = $('advancedModeBtn').textContent === langs[document.documentElement.lang]?.advancedMode ? '簡易設定' : langs[document.documentElement.lang]?.advancedMode;
        }

        function changeLanguage(lang) {
            document.documentElement.lang = lang;
            document.title = langs[lang]?.title || 'チケットメーカー';
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (langs[lang]?.[key]) {
                    if (el.tagName === 'LABEL') el.childNodes[0].textContent = langs[lang][key] + ': ';
                    else el.textContent = langs[lang][key];
                    if (el.tagName === 'BUTTON') el.setAttribute('aria-label', langs[lang][key]);
                }
            });
            $('qrCodeText').placeholder = langs[lang]?.qrCodeText || 'URLまたはテキスト';
            debouncedDraw();
        }

        document.querySelectorAll('input, select').forEach(input => {
            if (input.type === 'file') return;
            input.addEventListener('input', () => {
                if (input.classList.contains('position-input') || input.classList.contains('spacing-input') || input.classList.contains('size-input') || input.classList.contains('line-height-input') || input.classList.contains('shadow-input') || input.classList.contains('opacity-input')) {
                    validateInput(input, `${input.id}-error`);
                }
                debouncedDraw();
            });
        });

        $('qrCodeInput').addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f.type.startsWith('image/')) {
                alert(langs[document.documentElement.lang]?.qrFormatError || 'サポートされていないファイル形式です。画像を選択してください。');
                e.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = () => {
                qrImage = new Image();
                qrImage.src = reader.result;
                qrImage.onload = debouncedDraw;
            };
            reader.onerror = () => alert(langs[document.documentElement.lang]?.qrReadError || 'ファイルの読み込みに失敗しました。');
            reader.readAsDataURL(f);
        });

        $('customImageInput').addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f.type.startsWith('image/')) {
                alert(langs[document.documentElement.lang]?.qrFormatError || 'サポートされていないファイル形式です。画像を選択してください。');
                e.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = () => {
                customImage = new Image();
                customImage.src = reader.result;
                customImage.onload = debouncedDraw;
            };
            reader.onerror = () => alert(langs[document.documentElement.lang]?.qrReadError || 'ファイルの読み込みに失敗しました。');
            reader.readAsDataURL(f);
        });

        $('customFontInput').addEventListener('change', (e) => {
            const f = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                const font = new FontFace('CustomFont', reader.result);
                font.load().then((loadedFont) => {
                    document.fonts.add(loadedFont);
                    fonts.custom = 'CustomFont';
                    debouncedDraw();
                }).catch(() => {
                    alert(langs[document.documentElement.lang]?.fontLoadError || 'フォントの読み込みに失敗しました。デフォルトフォントを使用します。');
                    fonts.custom = null;
                    debouncedDraw();
                });
            };
            reader.readAsArrayBuffer(f);
        });

        Promise.all([
            new FontFace('ITC Avant Garde Gothic Std Extra Light', 'url(fonts/ITC Avant Garde Gothic Std Extra Light.woff2)').load(),
            new FontFace('AR ADGothicJP', ' bristles/fonts/jadhei01m.woff2)').load(),
            new FontFace('KozGoPr6N', 'url(fonts/KozGoPr6N-Medium.woff2)').load()
        ]).then(() => debouncedDraw()).catch((e) => {
            console.error('Font loading failed:', e);
            debouncedDraw();
        });

        changeLanguage('ja');
    </script>

    
