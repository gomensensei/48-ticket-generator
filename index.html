<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- 頭部內容不變 -->
</head>
<body>
    <!-- 廣告和語言選擇器不變 -->
    <div id="mainContainer">
        <div id="canvasContainer">
            <h1>チケットプレビュー</h1>
            <canvas id="ticketCanvas" aria-label="Ticket preview canvas"></canvas>
            <div id="previewSizeButtons">
                <button onclick="setPreviewScale(0.12)">12%</button><button onclick="setPreviewScale(0.25)">25%</button><button onclick="setPreviewScale(0.5)">50%</button><button onclick="setPreviewScale(1.0)">100%</button>
                <button id="slideModeBtn" onclick="toggleSlideMode()" aria-label="滑動模式">滑動モード</button>
            </div>
            <p id="slideModeNote" class="note" style="display:none;" data-key="slideModeNote">滑動モードが有効になると、マウスを押したまま（スマートフォンやタブレットでは指を押したまま）でプレビュー内のテキストを自由に移動できます。また、Shiftキーを押しながらマウスを押したまま（スマートフォンやタブレットでは通常のピンチズームジェスチャー）でテキストを拡大縮小できます。</p>
            <p id="disclaimer">AKB48メンバーの生誕祭劇場公演で、ファンの皆様が復刻した劇場チケットに感動し、趣味としてファンが自作チケットを保存できるウェブサイトを制作いたしました。商業目的や違法な使用はご遠慮ください。権利は© AKB48及び株式会社DHに帰属し、制作者は責任を負いかねます。何卒ご了承ください。</p>
        </div>
        <!-- controlsContainer 不變 -->
    </div>
    <!-- 廣告不變 -->
    <script>
        // 前半部分不變，直到 langs 定義
        const langs = {
            ja: { 
                // 原有內容不變，添加以下
                slideMode: '滑動モード', 
                slideModeNote: '滑動モードが有効になると、マウスを押したまま（スマートフォンやタブレットでは指を押したまま）でプレビュー内のテキストを自由に移動できます。また、Shiftキーを押しながらマウスを押したまま（スマートフォンやタブレットでは通常のピンチズームジェスチャー）でテキストを拡大縮小できます。' 
            },
            'zh-TW': { 
                slideMode: '滑動模式', 
                slideModeNote: '啟用滑動模式後，您可以按住滑鼠（在智能手機或平板電腦上則按住手指）在預覽中自由移動文字位置。此外，按住Shift鍵並拖動滑鼠（在智能手機或平板電腦上使用常規捏合縮放手勢）即可放大或縮小文字。' 
            },
            'zh-CN': { 
                slideMode: '滑动模式', 
                slideModeNote: '启用滑动模式后，您可以按住鼠标（在智能手机或平板电脑上则按住手指）在预览中自由移动文字位置。此外，按住Shift键并拖动鼠标（在智能手机或平板电脑上使用常规捏合缩放手势）即可放大或缩小文字。' 
            },
            en: { 
                slideMode: 'Slide Mode', 
                slideModeNote: 'When Slide Mode is enabled, you can hold the mouse (or press and hold on a smartphone/tablet) to freely move text in the preview. Additionally, hold Shift and drag the mouse (or use a standard pinch-zoom gesture on a smartphone/tablet) to scale the text.' 
            },
            ko: { 
                slideMode: '슬라이드 모드', 
                slideModeNote: '슬라이드 모드가 활성화되면 마우스를 누른 채로(스마트폰이나 태블릿에서는 손가락을 누른 채로) 프리뷰 내 텍스트를 자유롭게 이동할 수 있습니다. 또한 Shift 키를 누른 상태에서 마우스를 드래그하거나(스마트폰이나 태블릿에서는 일반 핀치 줌 제스처로) 텍스트를 확대/축소할 수 있습니다.' 
            },
            th: { 
                slideMode: 'โหมดเลื่อน', 
                slideModeNote: 'เมื่อเปิดใช้งานโหมดเลื่อน คุณสามารถกดเมาส์ค้างไว้ (หรือกดนิ้วค้างไว้บนสมาร์ทโฟน/แท็บเล็ต) เพื่อเลื่อนตำแหน่งข้อความในตัวอย่างได้อย่างอิสระ นอกจากนี้ กด Shift ค้างไว้แล้วลากเมาส์ (หรือใช้ท่าทางการซูมแบบปกติบนสมาร์ทโฟน/แท็บเล็ต) เพื่อขยายหรือย่อข้อความได้' 
            },
            id: { 
                slideMode: 'Mode Geser', 
                slideModeNote: 'Saat Mode Geser diaktifkan, Anda dapat menahan mouse (atau menekan dan menahan pada smartphone/tablet) untuk memindahkan teks di pratinjau secara bebas. Selain itu, tahan tombol Shift dan seret mouse (atau gunakan gerakan pinch-zoom standar pada smartphone/tablet) untuk memperbesar atau memperkecil teks.' 
            }
            // 其他語言原有內容不變
        };

        let slideMode = false, selectedText = null, startX, startY, pinchDistance;

        const toggleSlideMode = () => {
            slideMode = !slideMode;
            const btn = $('slideModeBtn');
            const note = $('slideModeNote');
            btn.textContent = slideMode ? (langs[document.documentElement.lang]?.slideMode + ' (ON)') : langs[document.documentElement.lang]?.slideMode || '滑動モード';
            note.style.display = slideMode ? 'block' : 'none';
            if (!slideMode) selectedText = null;
        };

        const getTextElement = (x, y, dpiVal = 300) => {
            const mmPx = dpiVal / 25.4;
            const bleed = $('bleedOption').checked ? 3 * mmPx : 0;
            const elements = [
                { id: 'rect1Line1', x: parseFloat($('rect1Line1X').value) * mmPx + bleed, y: parseFloat($('rect1Line1Y').value) * mmPx + bleed, size: parseFloat($('rect1Size').value) },
                { id: 'rect1Line2', x: parseFloat($('rect1Line2X').value) * mmPx + bleed, y: parseFloat($('rect1Line2Y').value) * mmPx + bleed, size: parseFloat($('rect1Line2Size').value) },
                { id: 'text2', x: parseFloat($('text2X').value) * mmPx + bleed, y: parseFloat($('text2Y').value) * mmPx + bleed, size: parseFloat($('text2Size').value) },
                { id: 'text3Line1', x: parseFloat($('text3Line1X').value) * mmPx + bleed, y: parseFloat($('text3Line1Y').value) * mmPx + bleed, size: parseFloat($('text3Size').value) },
                { id: 'text3Line2', x: parseFloat($('text3Line2X').value) * mmPx + bleed, y: parseFloat($('text3Line2Y').value) * mmPx + bleed, size: parseFloat($('text3Line2Size').value) },
                { id: 'text4Line1', x: parseFloat($('text4Line1X').value) * mmPx + bleed, y: parseFloat($('text4Line1Y').value) * mmPx + bleed, size: parseFloat($('text4Size').value) },
                { id: 'text5', x: parseFloat($('text5X').value) * mmPx + bleed, y: parseFloat($('text5Y').value) * mmPx + bleed, size: parseFloat($('text5Size').value) },
                { id: 'text6', x: parseFloat($('text6X').value) * mmPx + bleed, y: parseFloat($('text6Y').value) * mmPx + bleed, size: parseFloat($('text6Size').value) },
                { id: 'text10', x: parseFloat($('text10X').value) * mmPx + bleed, y: parseFloat($('text10Y').value) * mmPx + bleed, size: parseFloat($('text10Size').value) },
                { id: 'text11', x: parseFloat($('text11X').value) * mmPx + bleed, y: parseFloat($('text11Y').value) * mmPx + bleed, size: parseFloat($('text11Size').value) },
                { id: 'text12', x: parseFloat($('text12X').value) * mmPx + bleed, y: parseFloat($('text12Y').value) * mmPx + bleed, size: parseFloat($('text12Size').value) }
            ];
            return elements.find(e => Math.abs(x - e.x) < 50 && Math.abs(y - e.y) < 50);
        };

        canvas.addEventListener('mousedown', e => {
            if (!slideMode) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / previewScale;
            const y = (e.clientY - rect.top) / previewScale;
            selectedText = getTextElement(x, y);
            if (selectedText) {
                startX = x;
                startY = y;
            }
        });

        canvas.addEventListener('mousemove', e => {
            if (!slideMode || !selectedText) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / previewScale;
            const y = (e.clientY - rect.top) / previewScale;
            const mmPx = 300 / 25.4;
            if (e.shiftKey) {
                const scaleFactor = (y - startY) * 0.1;
                const sizeInput = $(selectedText.id + 'Size');
                sizeInput.value = Math.max(1, parseFloat(sizeInput.value) + scaleFactor);
            } else {
                const dx = (x - startX) / mmPx;
                const dy = (y - startY) / mmPx;
                $(selectedText.id + 'X').value = parseFloat($(selectedText.id + 'X').value) + dx;
                $(selectedText.id + 'Y').value = parseFloat($(selectedText.id + 'Y').value) + dy;
            }
            startX = x;
            startY = y;
            debouncedDraw();
        });

        canvas.addEventListener('mouseup', () => {
            if (slideMode) selectedText = null;
        });

        canvas.addEventListener('touchstart', e => {
            if (!slideMode || e.touches.length > 2) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = (touch.clientX - rect.left) / previewScale;
            const y = (touch.clientY - rect.top) / previewScale;
            selectedText = getTextElement(x, y);
            if (selectedText) {
                startX = x;
                startY = y;
            }
            if (e.touches.length === 2) {
                const t1 = e.touches[0], t2 = e.touches[1];
                pinchDistance = Math.hypot(t1.clientX - t2.clientX, t1.clientY - t2.clientY);
            }
        });

        canvas.addEventListener('touchmove', e => {
            if (!slideMode || !selectedText) return;
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            if (e.touches.length === 1) {
                const x = (e.touches[0].clientX - rect.left) / previewScale;
                const y = (e.touches[0].clientY - rect.top) / previewScale;
                const mmPx = 300 / 25.4;
                const dx = (x - startX) / mmPx;
                const dy = (y - startY) / mmPx;
                $(selectedText.id + 'X').value = parseFloat($(selectedText.id + 'X').value) + dx;
                $(selectedText.id + 'Y').value = parseFloat($(selectedText.id + 'Y').value) + dy;
                startX = x;
                startY = y;
            } else if (e.touches.length === 2) {
                const t1 = e.touches[0], t2 = e.touches[1];
                const newDistance = Math.hypot(t1.clientX - t2.clientX, t1.clientY - t2.clientY);
                const scaleFactor = (newDistance - pinchDistance) * 0.05;
                const sizeInput = $(selectedText.id + 'Size');
                sizeInput.value = Math.max(1, parseFloat(sizeInput.value) + scaleFactor);
                pinchDistance = newDistance;
            }
            debouncedDraw();
        });

        canvas.addEventListener('touchend', () => {
            if (slideMode) selectedText = null;
        });

        const changeLanguage = l => {
            document.documentElement.lang = l;
            document.title = langs[l]?.title || 'チケットメーカー';
            $('canvasContainer').querySelector('h1').textContent = langs[l]?.preview || 'チケットプレビュー';
            $('controlsContainer').querySelector('h1').textContent = langs[l]?.custom || 'オリジナルチケット';
            document.querySelectorAll('[data-key]').forEach(e => {
                const k = e.getAttribute('data-key'), t = langs[l]?.[k];
                if (t) e.tagName === 'LABEL' ? e.childNodes[0].textContent = `${t}: ` : e.tagName === 'BUTTON' ? e.textContent = t : e.classList.contains('note') && (e.textContent = t);
            });
            $('disclaimer').textContent = langs[l]?.disclaimer || langs.ja.disclaimer;
            document.querySelectorAll('input[type="text"], input[type="number"]').forEach(i => {
                const label = i.parentElement.childNodes[0].textContent.trim().replace(': ', '');
                i.setAttribute('aria-label', label);
            });
            $('slideModeBtn').textContent = slideMode ? (langs[l]?.slideMode + ' (ON)') : langs[l]?.slideMode || '滑動モード';
        };

        // 其他函數不變
    </script>
</body>
</html>
