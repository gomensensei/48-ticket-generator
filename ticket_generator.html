<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チケットメーカー</title>
    <style>
         @font-face {
            font-family: 'Alternate Gothic No2 D';
            src: url('fonts/AlternateGothicNo2DRegular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'AR ADGothicJP';
            src: url('fonts/jadhei01m.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'MS Gothic';
            src: url('fonts/msgothic.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        
       body {
    font-family: "MS Gothic", "AR ADGothicJP", sans-serif;
    margin: 0;
    padding: 20px;
    position: relative;
    background-color: #FFF4F6;
    color: #F676A6;
}
        #mainContainer { 
            display: flex; 
            justify-content: space-between; 
        }
        #canvasContainer { 
            width: 50%; 
            text-align: center; 
            overflow: auto; 
        }
        #ticketCanvas { 
            border: 1px solid #ccc; 
        }
        #controlsContainer { 
            width: 45%; 
            overflow-y: auto; 
            max-height: 90vh; 
        }
        .input-group { 
            margin: 10px 0; 
        }
        .note { 
            color: #F676A6; 
            font-size: 14px; 
        }
        .position-input, .spacing-input, .size-input, .line-height-input, .shadow-input, .opacity-input { 
            width: 50px; 
            margin-left: 5px; 
            display: none; 
        }
        .advanced-mode.active .position-input, 
        .advanced-mode.active .spacing-input, 
        .advanced-mode.active .size-input, 
        .advanced-mode.active .line-height-input, 
        .advanced-mode.active .shadow-input, 
        .advanced-mode.active .opacity-input { 
            display: inline; 
        }
        .advanced-label { 
            display: none; 
        }
        .advanced-mode.active .advanced-label { 
            display: inline; 
        }
        #advancedModeBtn { 
            margin-left: 10px; 
        }
        #previewSizeButtons { 
            margin-top: 10px; 
        }
        #previewSizeButtons button, .input-group button { 
            margin: 0 5px; 
            padding: 8px 16px; 
            border-radius: 20px; 
            border: none; 
            background-color: #F676A6; 
            color: #FFFFFF; 
            cursor: pointer; 
            font-family: "MS Gothic", "AR ADGothicJP", sans-serif;
        }
        #previewSizeButtons button:hover, .input-group button:hover { 
            background-color: #E55A8C; 
        }
        .ad-container { 
            text-align: center; 
            margin: 20px 0; 
        }
        #languageSelector { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            font-family: "MS Gothic", "AR ADGothicJP", sans-serif;
            color: #F676A6; 
        }

        /* 手機直向模式 */
        @media (max-width: 768px) and (orientation: portrait) {
            #mainContainer { 
                flex-direction: column; 
            }
            #canvasContainer, #controlsContainer { 
                width: 100%; 
            }
            #canvasContainer { 
                order: 2; 
            }
            #controlsContainer { 
                order: 1; 
            }
        }
    </style>
    <!-- Google AdSense 腳本（需替換為你的代碼） -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <!-- 引入 qrcode.js 庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <!-- 上方廣告 -->
    <div class="ad-container">
        <!-- 替換為你的 AdSense 廣告單元代碼 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="YYYYYYYYYY"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- 語言選擇 -->
    <select id="languageSelector" onchange="changeLanguage(this.value)">
        <option value="ja" selected>日本語</option>
        <option value="zh-TW">中文（繁體）</option>
        <option value="zh-CN">中文（简体）</option>
        <option value="en">English</option>
        <option value="ko">한국어</option>
        <option value="th">ไทย</option>
        <option value="id">Bahasa Indonesia</option>
    </select>

    <div id="mainContainer">
        <div id="canvasContainer">
            <h1>チケットプレビュー</h1>
            <canvas id="ticketCanvas"></canvas>
            <div id="previewSizeButtons">
                <button onclick="setPreviewScale(0.12)">12%</button>
                <button onclick="setPreviewScale(0.25)">25%</button>
                <button onclick="setPreviewScale(0.5)">50%</button>
                <button onclick="setPreviewScale(1.0)">100%</button>
            </div>
        </div>
        
        <div id="controlsContainer">
            <h1>オリジナルチケット</h1>
            
            <div class="input-group advanced-mode">
                <label data-key="rect1Line1">エリア1 テキスト (1行目): <input type="text" id="rect1Line1" value="AKB"></label>
                <label class="advanced-label">X: </label><input type="number" id="rect1Line1X" value="13.5" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="rect1Line1Y" value="12" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="rect1Spacing" value="-7000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="rect1Size" value="47" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="rect1Line2">エリア1 テキスト (2行目): <input type="text" id="rect1Line2" value="48"></label>
                <label class="advanced-label">X: </label><input type="number" id="rect1Line2X" value="13.5" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="rect1Line2Y" value="24" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="rect1Line2Spacing" value="-7000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="rect1Line2Size" value="47" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="rect1Color">エリア1 背景色: <input type="color" id="rect1Color" value="#2086D1"></label>
                <label data-key="rect1TextColor">エリア1 文字色: <input type="color" id="rect1TextColor" value="#FFFFFF"></label><br>
            </div>
            
            <div class="input-group advanced-mode">
                <label data-key="text2">テキスト2: <input type="text" id="text2" value="「ここからだ」 公演"></label>
                <label class="advanced-label">X: </label><input type="number" id="text2X" value="37" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text2Y" value="12" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text2Spacing" value="2000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text2Size" value="14.2" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="text3Line1">テキスト3 (1行目): <input type="text" id="text3Line1" value="秋元康 生誕祭"></label>
                <label class="advanced-label">X: </label><input type="number" id="text3Line1X" value="35" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text3Line1Y" value="19" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text3Spacing" value="2000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text3Size" value="14.2" class="size-input"><span class="advanced-label">pt</span>
                <label class="advanced-label">行間: </label><input type="number" id="text3LineHeight" value="18" class="line-height-input"><span class="advanced-label">pt</span><br>
                <label data-key="text3Line2">テキスト3 (2行目): <input type="text" id="text3Line2" value="AKB48劇場"></label>
                <label class="advanced-label">X: </label><input type="number" id="text3Line2X" value="35" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text3Line2Y" value="25" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text3Line2Spacing" value="2000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text3Line2Size" value="14.2" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="text4Line1">テキスト4 (1行目): <input type="text" id="text4Line1" value="＜日付＞2025年05月02日（金）"></label>
                <label class="advanced-label">X: </label><input type="number" id="text4Line1X" value="13" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text4Line1Y" value="43" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text4Spacing" value="1000" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text4Size" value="11" class="size-input"><span class="advanced-label">pt</span>
                <label class="advanced-label">行間: </label><input type="number" id="text4LineHeight" value="14" class="line-height-input"><span class="advanced-label">pt</span><br>
                <label data-key="text4Line2">テキスト4 (2行目): <input type="text" id="text4Line2" value="OPEN：18時10分       START：18時30分      ￥3,400"></label><br>
                <label data-key="text5">テキスト5: <input type="text" id="text5" value="048番"></label>
                <label class="advanced-label">X: </label><input type="number" id="text5X" value="13" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text5Y" value="55" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text5Spacing" value="200" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text5Size" value="16" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="text6">テキスト6: <input type="text" id="text6" value="① ❘ 000－0000 ❘ ゴメン先生 様"></label>
                <label class="advanced-label">X: </label><input type="number" id="text6X" value="36" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text6Y" value="55" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text6Spacing" value="311" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text6Size" value="13" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="textColor">文字色 (2-6): <input type="color" id="textColor" value="#000000"></label><br>
            </div>
            
            <div class="input-group advanced-mode">
                <label data-key="bgColor">全体の背景色: <input type="color" id="bgColor" value="#E5EDF9"></label><br>
                <label data-key="bgText">背景テキスト: <input type="text" id="bgText" value="AKB48"></label>
                <label class="advanced-label">X: </label><input type="number" id="bgTextX" value="-100" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="bgTextY" value="0" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="bgTextSpacing" value="-6000" class="spacing-input">
                <label class="advanced-label">行間: </label><input type="number" id="bgTextLineHeight" value="46" class="line-height-input"><span class="advanced-label">pt</span>
                <label class="advanced-label">サイズ: </label><input type="number" id="bgTextSize" value="62" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="bgTextColor">背景文字色: <input type="color" id="bgTextColor" value="#FFFFFF"></label>
                <label data-key="bgShadowColor">背景文字影の色: <input type="color" id="bgShadowColor" value="#5F96ED"></label>
                <label class="advanced-label">シャドウX: </label><input type="number" id="bgShadowX" value="0.5" step="0.1" class="shadow-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">シャドウY: </label><input type="number" id="bgShadowY" value="-0.4" step="0.1" class="shadow-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">シャドウ透明度: </label><input type="number" id="bgShadowOpacity" value="0.2" min="0" max="1" step="0.1" class="opacity-input"><span class="advanced-label">（0-1）</span><br>
            </div>
            
            <div class="input-group advanced-mode">
                <label data-key="rect9Color">エリア9 背景色: <input type="color" id="rect9Color" value="#2086D1"></label><br>
                <label data-key="text10">テキスト10: <input type="text" id="text10" value="<主催 ‧ お問い合せ>"></label>
                <label class="advanced-label">X: </label><input type="number" id="text10X" value="54" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text10Y" value="62.5" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text10Spacing" value="236" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text10Size" value="7" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="text11">テキスト11: <input type="text" id="text11" value="AKB48 Theater"></label>
                <label class="advanced-label">X: </label><input type="number" id="text11X" value="80.5" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text11Y" value="63" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text11Spacing" value="238" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text11Size" value="10" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="text12">テキスト12: <input type="text" id="text12" value="TEL:03-5298-8648"></label>
                <label class="advanced-label">X: </label><input type="number" id="text12X" value="108" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">Y: </label><input type="number" id="text12Y" value="63" class="position-input"><span class="advanced-label">mm</span>
                <label class="advanced-label">字間: </label><input type="number" id="text12Spacing" value="236" class="spacing-input">
                <label class="advanced-label">サイズ: </label><input type="number" id="text12Size" value="12.5" class="size-input"><span class="advanced-label">pt</span><br>
                <label data-key="footerTextColor">文字色 (10-12): <input type="color" id="footerTextColor" value="#FFFFFF"></label><br>
            </div>
            
            <div class="input-group">
                <label data-key="qrCodeText">QRコードの内容: <input type="text" id="qrCodeText" value="https://example.com" placeholder="URLかチケット番号を入力"></label><br>
                <label data-key="qrCodeInput">QRコード画像 (優先): <input type="file" id="qrCodeInput" accept="image/*"></label><br>
                <label data-key="showQR"><input type="checkbox" id="showQR" checked> QRコード枠を表示</label><br>
                <label data-key="qrSquareColor">QR枠の色: <input type="color" id="qrSquareColor" value="#2086D1"></label><br>
            </div>
            
            <div class="input-group">
                <label data-key="bleedOption"><input type="checkbox" id="bleedOption"> 裁ち落とし付き (+3mm)</label>
            </div>
            
            <div class="input-group">
                <button onclick="downloadTicket(300)" data-key="download300">ダウンロード (300 DPI)</button>
                <button onclick="downloadTicket(70)" data-key="download70">ダウンロード (70 DPI)</button>
                <button id="advancedModeBtn" onclick="toggleAdvancedMode()" data-key="advancedMode">詳細設定</button>
                <button onclick="window.open('https://paypal.me/gomensensei?country.x=HK&locale.x=zh_HK', '_blank')" data-key="donate">寄付する</button>
            </div>
            
            <p class="note" data-key="note">※ダウンロードしたPNGはRGBです。印刷用にCMYKへ変換するにはPhotoshopかGIMPをご利用ください。</p>
        </div>
    </div>

    <!-- 下方廣告 -->
    <div class="ad-container">
        <!-- 替換為你的 AdSense 廣告單元代碼 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="ZZZZZZZZZZ"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <script>
        const canvas = document.getElementById('ticketCanvas');
        const ctx = canvas.getContext('2d');
        let qrImage = null;
        let previewScale = 0.5;

        // 尺寸參數 (單位: mm -> 像素)
        const baseWidthMm = 150;
        const baseHeightMm = 65;
        const bleedMm = 3;
        const baseWidth300 = Math.round(baseWidthMm * 300 / 25.4);    // 1772 px @ 300 DPI
        const baseHeight300 = Math.round(baseHeightMm * 300 / 25.4);  // 767 px @ 300 DPI
        const bleedWidth300 = Math.round((baseWidthMm + 2 * bleedMm) * 300 / 25.4);   // 1843 px
        const bleedHeight300 = Math.round((baseHeightMm + 2 * bleedMm) * 300 / 25.4); // 838 px
        const baseWidth70 = Math.round(baseWidthMm * 70 / 25.4);    // 413 px @ 70 DPI
        const baseHeight70 = Math.round(baseHeightMm * 70 / 25.4);  // 179 px @ 70 DPI
        const bleedWidth70 = Math.round((baseWidthMm + 2 * bleedMm) * 70 / 25.4);   // 429 px
        const bleedHeight70 = Math.round((baseHeightMm + 2 * bleedMm) * 70 / 25.4); // 195 px

        // 字體定義（僅用於門票生成）
        const fontAvantGarde = 'Alternate Gothic No2 D';
        const fontMSGothic = 'MS Gothic';
        const fontARADGothic = 'AR ADGothicJP';

        // 語言翻譯數據
        const translations = {
            'ja': {
                'title': 'チケットメーカー',
                'preview': 'チケットプレビュー',
                'custom': 'オリジナルチケット',
                'rect1Line1': 'エリア1 テキスト (1行目)',
                'rect1Line2': 'エリア1 テキスト (2行目)',
                'rect1Color': 'エリア1 背景色',
                'rect1TextColor': 'エリア1 文字色',
                'text2': 'テキスト2',
                'text3Line1': 'テキスト3 (1行目)',
                'text3Line2': 'テキスト3 (2行目)',
                'text4Line1': 'テキスト4 (1行目)',
                'text4Line2': 'テキスト4 (2行目)',
                'text5': 'テキスト5',
                'text6': 'テキスト6',
                'textColor': '文字色 (2-6)',
                'bgColor': '全体の背景色',
                'bgText': '背景テキスト',
                'bgTextColor': '背景文字色',
                'bgShadowColor': '背景文字影の色',
                'rect9Color': 'エリア9 背景色',
                'text10': 'テキスト10',
                'text11': 'テキスト11',
                'text12': 'テキスト12',
                'footerTextColor': '文字色 (10-12)',
                'qrCodeText': 'QRコードの内容',
                'qrCodeInput': 'QRコード画像 (優先)',
                'showQR': 'QRコード枠を表示',
                'qrSquareColor': 'QR枠の色',
                'bleedOption': '裁ち落とし付き (+3mm)',
                'download300': 'ダウンロード (300 DPI)',
                'download70': 'ダウンロード (70 DPI)',
                'advancedMode': '詳細設定',
                'donate': '寄付する',
                'note': '※ダウンロードしたPNGはRGBです。印刷用にCMYKへ変換するにはPhotoshopかGIMPをご利用ください。',
                'qrPlaceholder': 'URLかチケット番号を入力'
            },
            'zh-TW': {
                'title': '門票生成器',
                'preview': '門票預覽',
                'custom': '自訂門票',
                'rect1Line1': '矩形1文字 (行1)',
                'rect1Line2': '矩形1文字 (行2)',
                'rect1Color': '矩形1顏色',
                'rect1TextColor': '矩形1文字顏色',
                'text2': '文字2',
                'text3Line1': '文字3 (行1)',
                'text3Line2': '文字3 (行2)',
                'text4Line1': '文字4 (行1)',
                'text4Line2': '文字4 (行2)',
                'text5': '文字5',
                'text6': '文字6',
                'textColor': '文字顏色 (2-6)',
                'bgColor': '背景顏色',
                'bgText': '背景文字',
                'bgTextColor': '背景文字顏色',
                'bgShadowColor': '背景陰影顏色',
                'rect9Color': '矩形9顏色',
                'text10': '文字10',
                'text11': '文字11',
                'text12': '文字12',
                'footerTextColor': '文字顏色 (10-12)',
                'qrCodeText': 'QR Code 內容',
                'qrCodeInput': 'QR Code 上傳（優先使用）',
                'showQR': '顯示 QR Code 正方形',
                'qrSquareColor': '正方形顏色',
                'bleedOption': '包含出血位 (每邊 +3mm)',
                'download300': '下載門票 (300 DPI)',
                'download70': '下載門票 (70 DPI)',
                'advancedMode': '進階模式',
                'donate': '捐贈',
                'note': '注意：下載的 PNG 為 RGB 模式。為印刷準備，請使用 Photoshop 或 GIMP 轉為 CMYK。',
                'qrPlaceholder': '輸入網址或票號'
            },
            'zh-CN': {
                'title': '门票生成器',
                'preview': '门票预览',
                'custom': '自定义门票',
                'rect1Line1': '矩形1文字 (行1)',
                'rect1Line2': '矩形1文字 (行2)',
                'rect1Color': '矩形1颜色',
                'rect1TextColor': '矩形1文字颜色',
                'text2': '文字2',
                'text3Line1': '文字3 (行1)',
                'text3Line2': '文字3 (行2)',
                'text4Line1': '文字4 (行1)',
                'text4Line2': '文字4 (行2)',
                'text5': '文字5',
                'text6': '文字6',
                'textColor': '文字颜色 (2-6)',
                'bgColor': '背景颜色',
                'bgText': '背景文字',
                'bgTextColor': '背景文字颜色',
                'bgShadowColor': '背景阴影颜色',
                'rect9Color': '矩形9颜色',
                'text10': '文字10',
                'text11': '文字11',
                'text12': '文字12',
                'footerTextColor': '文字颜色 (10-12)',
                'qrCodeText': 'QR Code 内容',
                'qrCodeInput': 'QR Code 上传（优先使用）',
                'showQR': '显示 QR Code 正方形',
                'qrSquareColor': '正方形颜色',
                'bleedOption': '包含出血位 (每边 +3mm)',
                'download300': '下载门票 (300 DPI)',
                'download70': '下载门票 (70 DPI)',
                'advancedMode': '高级模式',
                'donate': '捐款',
                'note': '注意：下载的 PNG 为 RGB 模式。为印刷准备，请使用 Photoshop 或 GIMP 转为 CMYK。',
                'qrPlaceholder': '输入网址或票号'
            },
            'en': {
                'title': 'Ticket Generator',
                'preview': 'Ticket Preview',
                'custom': 'Custom Ticket',
                'rect1Line1': 'Rectangle 1 Text (Line 1)',
                'rect1Line2': 'Rectangle 1 Text (Line 2)',
                'rect1Color': 'Rectangle 1 Color',
                'rect1TextColor': 'Rectangle 1 Text Color',
                'text2': 'Text 2',
                'text3Line1': 'Text 3 (Line 1)',
                'text3Line2': 'Text 3 (Line 2)',
                'text4Line1': 'Text 4 (Line 1)',
                'text4Line2': 'Text 4 (Line 2)',
                'text5': 'Text 5',
                'text6': 'Text 6',
                'textColor': 'Text Color (2-6)',
                'bgColor': 'Background Color',
                'bgText': 'Background Text',
                'bgTextColor': 'Background Text Color',
                'bgShadowColor': 'Background Shadow Color',
                'rect9Color': 'Rectangle 9 Color',
                'text10': 'Text 10',
                'text11': 'Text 11',
                'text12': 'Text 12',
                'footerTextColor': 'Text Color (10-12)',
                'qrCodeText': 'QR Code Content',
                'qrCodeInput': 'QR Code Upload (Priority)',
                'showQR': 'Show QR Code Square',
                'qrSquareColor': 'Square Color',
                'bleedOption': 'Include Bleed (3mm each side)',
                'download300': 'Download Ticket (300 DPI)',
                'download70': 'Download Ticket (70 DPI)',
                'advancedMode': 'Advanced Mode',
                'donate': 'Donate',
                'note': 'Note: The downloaded PNG is in RGB mode. For printing, please convert to CMYK using Photoshop or GIMP.',
                'qrPlaceholder': 'Enter URL or ticket number'
            },
            'ko': {
                'title': '티켓 생성기',
                'preview': '티켓 미리보기',
                'custom': '커스텀 티켓',
                'rect1Line1': '사각형 1 텍스트 (1행)',
                'rect1Line2': '사각형 1 텍스트 (2행)',
                'rect1Color': '사각형 1 색상',
                'rect1TextColor': '사각형 1 텍스트 색상',
                'text2': '텍스트 2',
                'text3Line1': '텍스트 3 (1행)',
                'text3Line2': '텍스트 3 (2행)',
                'text4Line1': '텍스트 4 (1행)',
                'text4Line2': '텍스트 4 (2행)',
                'text5': '텍스트 5',
                'text6': '텍스트 6',
                'textColor': '텍스트 색상 (2-6)',
                'bgColor': '배경 색상',
                'bgText': '배경 텍스트',
                'bgTextColor': '배경 텍스트 색상',
                'bgShadowColor': '배경 그림자 색상',
                'rect9Color': '사각형 9 색상',
                'text10': '텍스트 10',
                'text11': '텍스트 11',
                'text12': '텍스트 12',
                'footerTextColor': '텍스트 색상 (10-12)',
                'qrCodeText': 'QR 코드 내용',
                'qrCodeInput': 'QR 코드 업로드 (우선 사용)',
                'showQR': 'QR 코드 사각형 표시',
                'qrSquareColor': '사각형 색상',
                'bleedOption': '블리드 포함 (각 변 +3mm)',
                'download300': '티켓 다운로드 (300 DPI)',
                'download70': '티켓 다운로드 (70 DPI)',
                'advancedMode': '고급 모드',
                'donate': '기부',
                'note': '참고: 다운로드된 PNG는 RGB 모드입니다. 인쇄를 위해 Photoshop 또는 GIMP를 사용하여 CMYK로 변환하십시오.',
                'qrPlaceholder': 'URL 또는 티켓 번호 입력'
            },
            'th': {
                'title': 'เครื่องสร้างตั๋ว',
                'preview': 'ตัวอย่างตั๋ว',
                'custom': 'ตั๋วที่กำหนดเอง',
                'rect1Line1': 'ข้อความสี่เหลี่ยม 1 (บรรทัด 1)',
                'rect1Line2': 'ข้อความสี่เหลี่ยม 1 (บรรทัด 2)',
                'rect1Color': 'สีสี่เหลี่ยม 1',
                'rect1TextColor': 'สีข้อความสี่เหลี่ยม 1',
                'text2': 'ข้อความ 2',
                'text3Line1': 'ข้อความ 3 (บรรทัด 1)',
                'text3Line2': 'ข้อความ 3 (บรรทัด 2)',
                'text4Line1': 'ข้อความ 4 (บรรทัด 1)',
                'text4Line2': 'ข้อความ 4 (บรรทัด 2)',
                'text5': 'ข้อความ 5',
                'text6': 'ข้อความ 6',
                'textColor': 'สีข้อความ (2-6)',
                'bgColor': 'สีพื้นหลัง',
                'bgText': 'ข้อความพื้นหลัง',
                'bgTextColor': 'สีข้อความพื้นหลัง',
                'bgShadowColor': 'สีเงาพื้นหลัง',
                'rect9Color': 'สีสี่เหลี่ยม 9',
                'text10': 'ข้อความ 10',
                'text11': 'ข้อความ 11',
                'text12': 'ข้อความ 12',
                'footerTextColor': 'สีข้อความ (10-12)',
                'qrCodeText': 'เนื้อหา QR Code',
                'qrCodeInput': 'อัปโหลด QR Code (ใช้優先)',
                'showQR': 'แสดงสี่เหลี่ยม QR Code',
                'qrSquareColor': 'สีสี่เหลี่ยม',
                'bleedOption': 'รวมขอบตัด (ด้านละ +3mm)',
                'download300': 'ดาวน์โหลดตั๋ว (300 DPI)',
                'download70': 'ดาวน์โหลดตั๋ว (70 DPI)',
                'advancedMode': 'โหมดขั้นสูง',
                'donate': 'บริจาค',
                'note': 'หมายเหตุ: PNG ที่ดาวน์โหลดเป็นโหมด RGB สำหรับการพิมพ์ กรุณาแปลงเป็น CMYK โดยใช้ Photoshop หรือ GIMP',
                'qrPlaceholder': 'ป้อน URL หรือหมายเลขตั๋ว'
            },
            'id': {
                'title': 'Pembuat Tiket',
                'preview': 'Pratinjau Tiket',
                'custom': 'Tiket Kustom',
                'rect1Line1': 'Teks Persegi 1 (Baris 1)',
                'rect1Line2': 'Teks Persegi 1 (Baris 2)',
                'rect1Color': 'Warna Persegi 1',
                'rect1TextColor': 'Warna Teks Persegi 1',
                'text2': 'Teks 2',
                'text3Line1': 'Teks 3 (Baris 1)',
                'text3Line2': 'Teks 3 (Baris 2)',
                'text4Line1': 'Teks 4 (Baris 1)',
                'text4Line2': 'Teks 4 (Baris 2)',
                'text5': 'Teks 5',
                'text6': 'Teks 6',
                'textColor': 'Warna Teks (2-6)',
                'bgColor': 'Warna Latar Belakang',
                'bgText': 'Teks Latar Belakang',
                'bgTextColor': 'Warna Teks Latar Belakang',
                'bgShadowColor': 'Warna Bayangan Latar Belakang',
                'rect9Color': 'Warna Persegi 9',
                'text10': 'Teks 10',
                'text11': 'Teks 11',
                'text12': 'Teks 12',
                'footerTextColor': 'Warna Teks (10-12)',
                'qrCodeText': 'Konten QR Code',
                'qrCodeInput': 'Unggah QR Code (Prioritas)',
                'showQR': 'Tampilkan Kotak QR Code',
                'qrSquareColor': 'Warna Kotak',
                'bleedOption': 'Sertakan Bleed (3mm per sisi)',
                'download300': 'Unduh Tiket (300 DPI)',
                'download70': 'Unduh Tiket (70 DPI)',
                'advancedMode': 'Mode Lanjutan',
                'donate': 'Donasi',
                'note': 'Catatan: PNG yang diunduh dalam mode RGB. Untuk pencetakan, harap konversi ke CMYK menggunakan Photoshop atau GIMP.',
                'qrPlaceholder': 'Masukkan URL atau nomor tiket'
            }
        };

        // 精確字距與行距繪製函數
        function drawTextWithSpacingAndLeading(lines, x, y, font, fontSize, letterSpacing, lineHeight, color, align = 'left', alternateFont = null, dpi = 300) {
            const ptToPx = dpi / 72;
            ctx.fillStyle = color;
            ctx.textAlign = align;

            lines.forEach((line, index) => {
                let currentX = x;
                const lineY = y + (index * lineHeight * ptToPx);

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const isAlternate = alternateFont && /[A-Za-z0-9①❘－]/.test(char);
                    ctx.font = `${fontSize * ptToPx}px ${isAlternate ? alternateFont : font}`;
                    ctx.fillText(char, currentX, lineY);
                    const charWidth = ctx.measureText(char).width;
                    currentX += charWidth + (letterSpacing * ptToPx / 1000);
                }
            });
        }

        function drawTicket(dpi = 300) {
            const useBleed = document.getElementById('bleedOption').checked;
            const width = useBleed ? (dpi === 300 ? bleedWidth300 : bleedWidth70) : (dpi === 300 ? baseWidth300 : baseWidth70);
            const height = useBleed ? (dpi === 300 ? bleedHeight300 : bleedHeight70) : (dpi === 300 ? baseHeight300 : baseHeight70);
            const mmToPx = dpi / 25.4;

            canvas.width = width;
            canvas.height = height;
            canvas.style.width = (width * previewScale) + 'px';
            canvas.style.height = (height * previewScale) + 'px';

            ctx.clearRect(0, 0, width, height);

            // 背景顏色
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, width, height);

            // 背景文字與陰影
            const bgText = document.getElementById('bgText').value || "AKB48";
            const bgTextX = parseFloat(document.getElementById('bgTextX').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const bgTextY = parseFloat(document.getElementById('bgTextY').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const bgTextSpacing = parseFloat(document.getElementById('bgTextSpacing').value);
            const bgTextLineHeight = parseFloat(document.getElementById('bgTextLineHeight').value);
            const bgTextSize = parseFloat(document.getElementById('bgTextSize').value);
            ctx.font = `${bgTextSize * (dpi / 72)}px ${fontAvantGarde}`;

            const singleCharWidth = ctx.measureText(bgText.charAt(0)).width;
            const textWidth = ctx.measureText(bgText).width;
            const repeatGapX = textWidth + (bgTextSpacing * (dpi / 72) / 1000);
            const repeatGapY = bgTextLineHeight * (dpi / 72);

            ctx.globalAlpha = parseFloat(document.getElementById('bgShadowOpacity').value);
            ctx.fillStyle = document.getElementById('bgShadowColor').value;
            ctx.shadowColor = document.getElementById('bgShadowColor').value;
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = parseFloat(document.getElementById('bgShadowX').value) * mmToPx;
            ctx.shadowOffsetY = parseFloat(document.getElementById('bgShadowY').value) * mmToPx;
            let rowIndex = 0;
            for (let y = bgTextY; y < height; y += repeatGapY) {
                const rowOffset = rowIndex * singleCharWidth;
                for (let x = bgTextX + rowOffset; x < width; x += repeatGapX) {
                    ctx.fillText(bgText, x, y);
                }
                rowIndex++;
            }

            ctx.globalAlpha = 1;
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.fillStyle = document.getElementById('bgTextColor').value;
            rowIndex = 0;
            for (let y = bgTextY; y < height; y += repeatGapY) {
                const rowOffset = rowIndex * singleCharWidth;
                for (let x = bgTextX + rowOffset; x < width; x += repeatGapX) {
                    ctx.fillText(bgText, x, y);
                }
                rowIndex++;
            }

            // 矩形1
            ctx.fillStyle = document.getElementById('rect1Color').value;
            ctx.fillRect(8 * mmToPx + (useBleed ? bleedMm * mmToPx : 0), 0 + (useBleed ? bleedMm * mmToPx : 0), 25 * mmToPx, 35 * mmToPx);
            const rect1Color = document.getElementById('rect1TextColor').value;
            const rect1Line1X = parseFloat(document.getElementById('rect1Line1X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const rect1Line1Y = parseFloat(document.getElementById('rect1Line1Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const rect1Spacing = parseFloat(document.getElementById('rect1Spacing').value);
            const rect1Size = parseFloat(document.getElementById('rect1Size').value);
            const rect1Line2X = parseFloat(document.getElementById('rect1Line2X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const rect1Line2Y = parseFloat(document.getElementById('rect1Line2Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
            const rect1Line2Spacing = parseFloat(document.getElementById('rect1Line2Spacing').value);
            const rect1Line2Size = parseFloat(document.getElementById('rect1Line2Size').value);
            drawTextWithSpacingAndLeading([document.getElementById('rect1Line1').value], rect1Line1X, rect1Line1Y, fontAvantGarde, rect1Size, rect1Spacing, 0, rect1Color, 'center', null, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('rect1Line2').value], rect1Line2X, rect1Line2Y, fontAvantGarde, rect1Line2Size, rect1Line2Spacing, 0, rect1Color, 'center', null, dpi);

            // 其他文字
            const textColor = document.getElementById('textColor').value;
            drawTextWithSpacingAndLeading([document.getElementById('text2').value], parseFloat(document.getElementById('text2X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text2Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text2Size').value), parseFloat(document.getElementById('text2Spacing').value), 0, textColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text3Line1').value], parseFloat(document.getElementById('text3Line1X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text3Line1Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text3Size').value), parseFloat(document.getElementById('text3Spacing').value), 0, textColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text3Line2').value], parseFloat(document.getElementById('text3Line2X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text3Line2Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text3Line2Size').value), parseFloat(document.getElementById('text3Line2Spacing').value), 0, textColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text4Line1').value, document.getElementById('text4Line2').value], parseFloat(document.getElementById('text4Line1X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text4Line1Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text4Size').value), parseFloat(document.getElementById('text4Spacing').value), parseFloat(document.getElementById('text4LineHeight').value), textColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text5').value], parseFloat(document.getElementById('text5X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text5Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text5Size').value), parseFloat(document.getElementById('text5Spacing').value), 27, textColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text6').value], parseFloat(document.getElementById('text6X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text6Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text6Size').value), parseFloat(document.getElementById('text6Spacing').value), 27, textColor, 'left', fontARADGothic, dpi);

            // 矩形9
            ctx.fillStyle = document.getElementById('rect9Color').value;
            ctx.fillRect(0 + (useBleed ? bleedMm * mmToPx : 0), 58 * mmToPx + (useBleed ? bleedMm * mmToPx : 0), 150 * mmToPx, 7 * mmToPx);

            // 文字10-12
            const footerColor = document.getElementById('footerTextColor').value;
            drawTextWithSpacingAndLeading([document.getElementById('text10').value], parseFloat(document.getElementById('text10X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text10Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text10Size').value), parseFloat(document.getElementById('text10Spacing').value), 0, footerColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text11').value], parseFloat(document.getElementById('text11X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text11Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text11Size').value), parseFloat(document.getElementById('text11Spacing').value), 0, footerColor, 'left', fontARADGothic, dpi);
            drawTextWithSpacingAndLeading([document.getElementById('text12').value], parseFloat(document.getElementById('text12X').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), parseFloat(document.getElementById('text12Y').value) * mmToPx + (useBleed ? bleedMm * mmToPx : 0), fontMSGothic, parseFloat(document.getElementById('text12Size').value), parseFloat(document.getElementById('text12Spacing').value), 0, footerColor, 'left', fontARADGothic, dpi);

            // QR Code 正方形
            if (document.getElementById('showQR').checked) {
                ctx.fillStyle = document.getElementById('qrSquareColor').value;
                const qrX = width - 8.5 * mmToPx - 23 * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
                const qrY = 23 * mmToPx + (useBleed ? bleedMm * mmToPx : 0);
                const qrSize = 23 * mmToPx;
                ctx.fillRect(qrX, qrY, qrSize, qrSize);

                const qrText = document.getElementById('qrCodeText').value;
                if (qrImage) {
                    ctx.drawImage(qrImage, qrX, qrY, qrSize, qrSize);
                } else if (qrText) {
                    const qrCanvas = document.createElement('canvas');
                    const qrContext = qrCanvas.getContext('2d');
                    qrCanvas.width = qrSize;
                    qrCanvas.height = qrSize;
                    const qrcode = new QRCode(qrCanvas, {
                        text: qrText,
                        width: qrSize,
                        height: qrSize,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    ctx.drawImage(qrCanvas, qrX, qrY, qrSize, qrSize);
                }
            }
        }

        function setPreviewScale(scale) {
            previewScale = scale;
            drawTicket(300);
        }

        function downloadTicket(dpi) {
            drawTicket(dpi);
            const link = document.createElement('a');
            link.download = `ticket_${dpi}dpi${document.getElementById('bleedOption').checked ? '_with_bleed' : ''}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            drawTicket(300); // 恢復預覽
        }

        document.getElementById('qrCodeInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    qrImage = new Image();
                    qrImage.src = event.target.result;
                    qrImage.onload = () => drawTicket(300);
                };
                reader.readAsDataURL(file);
            }
        });

        // 即時預覽
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', () => drawTicket(300));
        });

        // 進階模式切換
        function toggleAdvancedMode() {
            const groups = document.querySelectorAll('.advanced-mode');
            groups.forEach(group => group.classList.toggle('active'));
            const btn = document.getElementById('advancedModeBtn');
            const lang = document.documentElement.lang;
            btn.textContent = btn.textContent === translations[lang]['advancedMode'] ? 
                (lang === 'ja' ? '詳細設定を閉じる' : lang === 'zh-TW' ? '關閉進階模式' : 'Close Advanced Mode') : 
                translations[lang]['advancedMode'];
        }

        // 語言切換
        function changeLanguage(lang) {
            document.documentElement.lang = lang;
            document.title = translations[lang]['title'];
            document.querySelector('#canvasContainer h1').textContent = translations[lang]['preview'];
            document.querySelector('#controlsContainer h1').textContent = translations[lang]['custom'];
            
            // 更新所有帶 data-key 的元素
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[lang][key]) {
                    if (element.tagName === 'LABEL') {
                        element.childNodes[0].textContent = translations[lang][key] + ': ';
                    } else if (element.tagName === 'BUTTON') {
                        element.textContent = translations[lang][key];
                    } else if (element.classList.contains('note')) {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            document.querySelector('#qrCodeText').placeholder = translations[lang]['qrPlaceholder'];
        }

        // 初始生成
        drawTicket(300);
    </script>
</body>
</html>
